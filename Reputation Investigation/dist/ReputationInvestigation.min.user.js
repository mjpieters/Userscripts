// ==UserScript==
// @name         Reputation Investigation
// @namespace    https://github.com/rjrudman/Userscripts/ReputationInvestigation
// @version      2.0.0
// @author       Rob
// @match        *://*.stackexchange.com/*/*?tab=reputation*
// @match        *://*.stackoverflow.com/users/*/*?tab=reputation*
// @match        *://*.superuser.com/*/*?tab=reputation*
// @match        *://*.serverfault.com/*/*?tab=reputation*
// @match        *://*.askubuntu.com/*/*?tab=reputation*
// @match        *://*.stackapps.com/*/*?tab=reputation*
// @match        *://*.mathoverflow.net/*/*?tab=reputation*
// @exclude      *://chat.stackexchange.com/*
// @exclude      *://chat.meta.stackexchange.com/*
// @exclude      *://chat.stackoverflow.com/*
// @exclude      *://blog.stackoverflow.com/*
// @exclude      *://*.area51.stackexchange.com/*
// @require      https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js
// @grant        GM_xmlhttpRequest
// ==/UserScript==
!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";function r(e,t){function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]]);return n}function a(e,t,n,r){var o,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,n,i):o(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}function i(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function s(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,u)}s((r=r.apply(e,t||[])).next())})}function c(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],a=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,i,u,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u}function l(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function p(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function d(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function v(e,t,n){function r(e){l[e]&&(c[e]=function(t){return new Promise(function(n,r){p.push([e,t,n,r])>1||o(e,t)})})}function o(e,t){try{a(l[e](t))}catch(e){s(p[0][3],e)}}function a(e){e.value instanceof _?Promise.resolve(e.value.v).then(i,u):s(p[0][2],e)}function i(e){o("next",e)}function u(e){o("throw",e)}function s(e,t){e(t),p.shift(),p.length&&o(p[0][0],p[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,l=n.apply(e,t||[]),p=[];return c={},r("next"),r("throw"),r("return"),c[Symbol.asyncIterator]=function(){return this},c}function y(e){function t(t,o){e[t]&&(n[t]=function(n){return(r=!r)?{value:_(e[t](n)),done:"return"===t}:o?o(n):n})}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n}function h(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof p?p(e):e[Symbol.iterator]()}function g(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}Object.defineProperty(t,"__esModule",{value:!0}),t.__extends=r,n.d(t,"__assign",function(){return b}),t.__rest=o,t.__decorate=a,t.__param=i,t.__metadata=u,t.__awaiter=s,t.__generator=c,t.__exportStar=l,t.__values=p,t.__read=d,t.__spread=f,t.__await=_,t.__asyncGenerator=v,t.__asyncDelegator=y,t.__asyncValues=h,t.__makeTemplateObject=g;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}},function(e,t,n){var r,o;r=[n,t,n(2)],void 0!==(o=function(e,t,n){"use strict";function r(e){return!!t.ReversableTypes.find(function(t){return t===e})}function o(e){return!!t.ReversalTypes.find(function(t){return t===e})}function a(e){return!!t.OppositePairs.find(function(t){return t===e})}function i(e){return n.UnionOfArraysToArrayOfUnions(t.VoteReversalPairs[e])}Object.defineProperty(t,"__esModule",{value:!0}),t.AllVoteTypes=["asker_accepts_answer","asker_unaccept_answer","answer_accepted","answer_unaccepted","voter_downvotes","voter_undownvotes","post_downvoted","post_undownvoted","post_upvoted","post_unupvoted","suggested_edit_approval_received","post_flagged_as_spam","post_flagged_as_offensive","bounty_given","bounty_earned","bounty_cancelled","post_deleted","post_undeleted","association_bonus","arbitrary_reputation_change","vote_fraud_reversal","post_migrated","user_deleted","example_upvoted","example_unupvoted","proposed_change_approved","doc_link_upvoted","doc_link_unupvoted","doc_source_removed","suggested_edit_approval_overridden"],t.ReversalTypes=["asker_unaccept_answer","answer_unaccepted","user_deleted","vote_fraud_reversal"],t.ReversableTypes=["asker_accepts_answer","answer_accepted","post_downvoted","post_upvoted"],t.OppositePairs=["asker_accepts_answer","asker_unaccept_answer","answer_accepted","answer_unaccepted","voter_downvotes","voter_undownvotes","post_downvoted","post_undownvoted","post_upvoted","post_unupvoted","post_deleted","post_undeleted"],t.VoteOppositePairs={asker_accepts_answer:"asker_unaccept_answer",asker_unaccept_answer:"asker_accepts_answer",answer_accepted:"answer_unaccepted",answer_unaccepted:"answer_accepted",voter_downvotes:"voter_undownvotes",voter_undownvotes:"voter_downvotes",post_downvoted:"post_undownvoted",post_undownvoted:"post_downvoted",post_upvoted:"post_unupvoted",post_unupvoted:"post_upvoted",post_deleted:"post_undeleted",post_undeleted:"post_deleted"},t.VoteReversalPairs={asker_accepts_answer:["asker_unaccept_answer"],answer_accepted:["answer_unaccepted"],post_downvoted:["user_deleted","vote_fraud_reversal"],post_upvoted:["user_deleted","vote_fraud_reversal"],suggested_edit_approval_received:["vote_fraud_reversal"]},t.IsReversableType=r,t.IsReversalType=o,t.HasOppositePair=a,t.GetReversalTypes=i}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t],void 0!==(o=function(e,t){"use strict";function n(e){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n)}function r(e,t){return e.reduce(function(e,n){var r=t(n);return(e[r]=e[r]||[]).push(n),e},{})}function o(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})}function a(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.AddStyleText=n,t.GroupBy=r,t.Distinct=o,t.UnionOfArraysToArrayOfUnions=a}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(2),n(4),n(5),n(1)],void 0!==(o=function(e,t,n,r,o,a,i){"use strict";function u(e,t){return e%2==0&&(e+=t/2),"hsla("+360/t*e%360+", 80%, 50%, 0.3)"}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){if(e>=26){var t=e%26;return s(e/26-1)+String.fromCharCode(t+65)}return String.fromCharCode(e+65)};$(function(){r.AddStyleText("\n.detailed_reputation_table {\n    width: 100%;\n    font-size: 10px;\n}\n\n.detailed_reputation_table td {\n    padding: 5px;\n}\n\n.detailed_reputation_table tr:nth-child(even) {\n    background-color: #f2f2f2;\n}\n\n.detailed_reputation_table_header {\n    font-size: 12px;\n    border-top: 1px solid black;\n}\n\n.post-matcher {\n    opacity: 0;\n    padding-left: 5px;\n}\n\n.detailed_reputation_table tr > td.post-col:hover .post-matcher,\n.detailed_reputation_table_highlighted .post-matcher {\n    opacity: 1;\n}\n\n.user-details-div {\n    display: inline;\n    margin-left: 15px;\n}\n.user-details-div a {\n    margin-left: 5px;\n}\n\n.summary-table {\n    width: 100%;\n    margin: 5px;\n    font-size: 15px;\n}\n\n.summary-table p {\n    color: red;\n    display: inline;\n}\n\n.reversal-type {\n    cursor: default;\n}\n\n.rep-change {\n    font-size: 12px;\n    font-weight: bold;\n}\n.rep-change-positive {\n    color: green;\n}\n.rep-change-negative {\n    color: red;\n}\n#detailed_reputation_body > tr.reversal {\n    background-color: rgb(239, 145, 125);\n}\ntr.reversal > td.post-col > a,\ntr.reversal > td.post-col > a:hover {\n    color: #12009e\n}\n"),$.event.special.destroyed={remove:function(e){e.handler&&e.handler()}},StackExchange.initialized.then(function(){function e(){var n=$('<a href="/users/'+r+'?tab=reputation&amp;sort=detailed">detailed</a>');if(window.location.href.match(c)){$(".user-tab-sorts a").removeClass("youarehere"),$(n).addClass("youarehere"),$("#stats").prepend('<div id="rep-page-summary">'),t(45,3);var o=$('<a style="margin-left: 10px" href="https://stackoverflow.com/admin/xref-user-ips/'+r+'" target="_blank">xref</a>'),a=$('<a style="margin-left: 10px" href="https://stackoverflow.com/admin/show-user-votes/'+r+'" target="_blank">votes</a>');StackExchange.options.user.isModerator&&($("#stats").prepend(o),$("#stats").prepend(a));var i=$('<input type="number" value="3" />');$("#stats").prepend(i),$("#stats").prepend('<label style="margin-right: 15px; margin-left: 15px;">Set minimum bucket size</label>');var u=$('<input type="number" value="45" />');$("#stats").prepend(u),$("#stats").prepend('<label style="margin-right: 15px;">Set number of seconds between votes</label>');var s=function(){t(parseInt(u.val(),10),parseInt(i.val(),10))};u.change(s),i.change(s)}n.bind("destroyed",function(){setTimeout(function(){e()})}),$(".user-tab-sorts").append(n)}function t(e,c){var l=$("#rep-page-container");l.empty();var p=$("#rep-page-summary");p.empty();var d=$(".user-tab-footer");d.empty();var f=o.GetCurrentReputationPage(r),_=[],v=[],y=function(){_.forEach(function(e){return e.removeClass("detailed_reputation_table_highlighted")}),_=[]},h=function(e){_.forEach(function(e){return e.removeClass("detailed_reputation_table_highlighted")}),_=v[e],_.forEach(function(e){return e.addClass("detailed_reputation_table_highlighted")})};f.then(function(f){var g,m;if(f.hasMore){var b=$('<a href="javascript:void(0);">Load more</a>');b.click(function(){b.hide(),o.GetNextReputationPage(r).then(function(){return t(e,c)})}),d.append(b)}var x=JSON.parse(JSON.stringify(f)),w=a.ProcessEvents(x.items,c,e);w.sort(function(e,t){return t.creation_date-e.creation_date});var k=$('\n                    <table class="detailed_reputation_table">\n                        <tbody id="detailed_reputation_body">\n                        </tbody>\n                    </table>\n                    '),O=["user_deleted","vote_fraud_reversal"],R=k.find("#detailed_reputation_body"),P=[],B=Math.max.apply(Math,n.__spread(w.map(function(e){return e.BucketIndex})))+1;try{for(var S=n.__values(w),I=S.next();!I.done;I=S.next()){var j=I.value;!function(e){var t=void 0;t=e.Cancelled||0===e.reputation_change?"rep-change-neutral":e.reputation_change>0?"rep-change-positive":"rep-change-negative";var n=$("\n                    <tr>\n                        <td>"+moment.unix(e.creation_date).format("YYYY-MM-DD HH:mm:ss")+"</td>\n                        <td>"+e.reputation_history_type+'</td>\n                        <td id="rep-change" class="rep-change '+t+'">'+(e.reputation_change>=0?"+":"")+e.reputation_change+'</td>\n                        <td class="post-col"><a href="/q/'+e.post_id+'">'+(e.title||e.post_id+" (deleted)")+'</a><a class="post-matcher" href="javascript:void(0);">📌</a></td>\n                        <td class="reversal-type"></td>\n                    </tr>\n                    ');"association_bonus"===e.reputation_history_type&&n.find(".post-col").empty(),e.Cancelled&&n.css("text-decoration","line-through");var r=n.find(".post-matcher"),o=!1;r.click(function(){!o&&n.hasClass("detailed_reputation_table_highlighted")?y():(h(e.post_id),o=!1)});var a=n.find(".post-col");if(a.mouseenter(function(){_.length||(o=!0,h(e.post_id))}),a.mouseleave(function(){o&&(y(),o=!1)}),e.BucketIndex>=0){var c=!1,l=u(e.BucketIndex,B);if(void 0===P[e.BucketIndex]){var p=e.Bucket.length,d=e.Bucket.filter(function(e){return!e.Cancelled}).length,f=s(B-e.BucketIndex-1),g=p===d?p+" events":d+" events ("+p+" total)",m=e.Bucket.reduce(function(e,t){return e+t.reputation_change},0)+" reputation",b="Group "+f+". "+g+". "+m,w=O.indexOf(e.reputation_history_type)>=0?"vote_fraud_reversal"===e.reputation_history_type?"Reversal":"User deleted":"";""!==w?(b+=" - "+w+" 🔥",c=!0,P[e.BucketIndex]=!0):P[e.BucketIndex]=!1;var k=$('\n                        <tr  class="detailed_reputation_table_header">\n                            <td colspan="7">\n                                '+b+"\n                            </td>\n                        </tr>\n                        ");c?k.addClass("reversal"):k.css("background-color",l),R.append(k)}else P[e.BucketIndex]&&(c=!0);c?n.addClass("reversal"):n.css("background-color",l);var S=e.reputation_change;if(0===S){var I=x.items.find(function(t){return t.post_id===e.post_id&&t.reputation_history_type===e.reputation_history_type&&t.reputation_change>0});I&&(S=I.reputation_change,n.find("#rep-change").text(n.find("#rep-change").text()+" ("+S+")"))}if(!e.Cancelled&&i.IsReversableType(e.reputation_history_type)){var w=void 0,j=void 0;e.ReversedBy.length>e.Pairs?(w="✅",j="Vote was reversed"):0===e.ReversedBy.length?(w="❌",j="Vote was not reversed"):(w="⚠️ "+e.ReversedBy.length+"/"+(e.Pairs+1),j="Vote may not have been reversed");var T=n.find(".reversal-type");T.text(w),T.attr("title",j)}}R.append(n),v[e.post_id]||(v[e.post_id]=[]),v[e.post_id].push(n)}(j)}}catch(e){g={error:e}}finally{try{I&&!I.done&&(m=S.return)&&m.call(S)}finally{if(g)throw g.error}}l.append(k);var T=w.filter(function(e){return e.IsBucketed&&i.IsReversableType(e.reputation_history_type)&&e.ReversedBy.length<=e.Pairs}).map(function(e){return{VoteSlice:1-e.ReversedBy.length/(e.Pairs+1),Reputation:e.reputation_change*(1-e.ReversedBy.length/(e.Pairs+1))}});if(T.length){var C=T.map(function(e){return e.VoteSlice}).reduce(function(e,t){return e+t},0),E=T.map(function(e){return e.Reputation}).reduce(function(e,t){return e+t},0);p.append('\n                            <hr style="margin-bottom: 0px;" />\n                            <table class="summary-table">\n                                <tr>\n                                    <td><p>Total votes</p>: '+w.filter(function(e){return e.IsBucketed&&i.IsReversableType(e.reputation_history_type)}).length+"</td>\n                                    <td><p>Votes not reversed</p>: "+Math.round(C)+"</td>\n                                    <td><p>Reputation not reversed</p>: "+Math.round(E)+'</td>\n                                </tr>\n                            </table>\n                            <hr style="margin-bottom: 0px;" />\n                        ')}else p.append('\n                            <hr style="margin-bottom: 0px;" />\n                            <p style="margin-top: 5px; margin-bottom: 5px; margin-left: 5px;">All suspicious votes reversed</p>\n                            <hr style="margin-bottom: 0px;" />\n                        ')})}var r=StackExchange.user.options.userId,c=/&sort=detailed/;e()})})}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0)],void 0!==(o=function(e,t,n){"use strict";function r(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(n){return t=new Promise(function(t,n){u?t(u):o(e).then(function(e){u?t(u):n()})}),[2,t]})})}function o(e){i++;var t=location.hostname.replace(".com",""),r="https://api.stackexchange.com/2.2/users/"+e+"/reputation-history?key="+a+"&pagesize=100&page="+i+"&site="+t,o=function(e){return"https://api.stackexchange.com/2.2/posts/"+e.filter(function(e){return!!e}).join(";")+"?key="+a+"&pagesize=100&site="+t+"&filter=!)qFc_2zhzdy0KDoW*IEu"};return fetch(r).then(function(e){return e.json()}).then(function(e){var t=e.items,r=t.map(function(e){return e.post_id}),a=o(r);return fetch(a).then(function(e){return e.json()}).then(function(r){var o,a,i,s,c={};try{for(var l=n.__values(r.items),p=l.next();!p.done;p=l.next()){var d=p.value;c[d.post_id+""]=d.title}}catch(e){o={error:e}}finally{try{p&&!p.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}try{for(var f=n.__values(t),_=f.next();!_.done;_=f.next()){var v=_.value;v.title=c[v.post_id+""]}}catch(e){i={error:e}}finally{try{_&&!_.done&&(s=f.return)&&s.call(f)}finally{if(i)throw i.error}}u=u?{items:u.items.concat(t),hasMore:e.has_more}:{items:t,hasMore:e.has_more}})})}Object.defineProperty(t,"__esModule",{value:!0});var a="ESZ7eo2s9qErse9jq5qFxg((",i=0,u=null;t.GetCurrentReputationPage=r,t.GetNextReputationPage=o}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(6),n(7)],void 0!==(o=function(e,t,n,r,o){"use strict";function a(e,t,a){void 0===t&&(t=3),void 0===a&&(a=3e4);var i=r.ProcessBuckets(e,a,t),u=o.FindEventReversals(i.filter(function(e){return e.BucketSize>=t})),s=i.filter(function(e){return e.BucketSize<t}),c=u.concat(s.map(function(e){return n.__assign({},e,{Reversed:[],ReversedBy:[],Pairs:0,OriginalEvent:e.OriginalEvent||e})}));return c.sort(function(e,t){return e.creation_date-t.creation_date}),c}Object.defineProperty(t,"__esModule",{value:!0}),t.ProcessEvents=a}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(1)],void 0!==(o=function(e,t,n,r){"use strict";function o(e){return e.reduce(function(e,t){return e+t.reputation_change},0)}function a(e){return Math.min.apply(Math,n.__spread(e.map(function(e){return e.creation_date})))}function i(e){return Math.max.apply(Math,n.__spread(e.map(function(e){return e.creation_date})))}function u(e,t,r){var o=e.map(function(e){return[n.__assign({},e,{IsBucketed:!1,BucketIndex:0,BucketSize:0,Bucket:[],Cancelled:!1,OriginalEvent:e})]});s(o,t);var i=0;o.sort(function(e,t){return a(e)-a(t)});var u=o.map(function(e){var t,o,a=e.filter(function(e){return!e.Cancelled}).length>=r,u=e.filter(function(e){return!e.Cancelled}).length,s=a?i++:-1,c=e.map(function(e){return n.__assign({},e,{IsBucketed:a,BucketIndex:s,BucketSize:u})});try{for(var l=n.__values(c),p=l.next();!p.done;p=l.next()){p.value.Bucket=c}}catch(e){t={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(t)throw t.error}}return c}).reduce(function(e,t){return e.concat(t)},[]);return u.sort(function(e,t){return e.creation_date-t.creation_date}),u}function s(e,t){var r,o,u=!1;try{for(var p=n.__values(e),d=p.next();!d.done;d=p.next()){var f=d.value;!function(r){var o,s,p,d,f=e.filter(function(e){return e!==r&&(a(e)>=a(r)&&a(e)-i(r)<t||a(r)>=a(e)&&a(r)-i(e)<t)});f.sort(function(e,t){return a(e)-a(t)});try{for(var _=n.__values(f),v=_.next();!v.done;v=_.next()){var y=v.value;try{for(var h=n.__values(y),g=h.next();!g.done;g=h.next()){var m=g.value;c(r,y,m)&&(l(r,y,m),u=!0)}}catch(e){p={error:e}}finally{try{g&&!g.done&&(d=h.return)&&d.call(h)}finally{if(p)throw p.error}}}}catch(e){o={error:e}}finally{try{v&&!v.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}}(f)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}if(u)return void s(e,t)}function c(e,t,n){if(!r.IsReversableType(n.reputation_history_type)&&!r.IsReversalType(n.reputation_history_type)&&!r.HasOppositePair(n.reputation_history_type))return!1;if(r.HasOppositePair(n.reputation_history_type)){var a=r.VoteOppositePairs[n.reputation_history_type];if(e.some(function(e){return a===e.reputation_history_type&&n.post_id===e.post_id&&!e.Cancelled}))return!0}if(e.some(function(e){return e.post_id===n.post_id&&e.reputation_history_type===n.reputation_history_type&&!e.Cancelled}))return!1;var i=o(e);return!(n.reputation_change>=0&&i<0)&&(!(n.reputation_change<0&&i>=0)&&!(e.length<t.length))}function l(e,t,n){if(r.HasOppositePair(n.reputation_history_type)){var o=r.VoteOppositePairs[n.reputation_history_type],a=e.filter(function(e){return o===e.reputation_history_type&&n.post_id===e.post_id&&!e.Cancelled});a.length&&(a[0].Cancelled=!0,n.Cancelled=!0)}e.unshift(n),t.splice(t.indexOf(n),1)}Object.defineProperty(t,"__esModule",{value:!0}),t.ProcessBuckets=u}.apply(t,r))&&(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(0),n(1)],void 0!==(o=function(e,t,n,r){"use strict";function o(e){var t=u(e);return i(t),a(t),t}function a(e){var t,o,a,i,u=e.filter(function(e){return r.IsReversalType(e.reputation_history_type)});try{for(var s=n.__values(u),c=s.next();!c.done;c=s.next()){var l=c.value;try{for(var p=n.__values(l.Reversed),d=p.next();!d.done;d=p.next()){d.value.Pairs=l.Reversed.length-1}}catch(e){a={error:e}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}l.Pairs=0}}catch(e){t={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(t)throw t.error}}}function i(e){var t,o,a=!1,u=e.filter(function(e){return r.IsReversalType(e.reputation_history_type)});try{for(var s=n.__values(u),c=s.next();!c.done;c=s.next()){var l=c.value;!function(e){var t,r;if(1===e.Reversed.length){var o=e.Reversed[0],i=u.filter(function(t){return t!==e&&t.Reversed.indexOf(o)>=0});o.ReversedBy=[e];try{for(var s=n.__values(i),c=s.next();!c.done;c=s.next()){var l=c.value;l.Reversed.splice(l.Reversed.indexOf(o),1),a=!0}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}}(l)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(t)throw t.error}}a&&i(e)}function u(e){var t,o,a=e.map(function(e){return n.__assign({},e,{Reversed:[],ReversedBy:[],Pairs:0,OriginalEvent:e.OriginalEvent||e})}),i=function(e){return a.filter(function(t){return t.post_id===e})};try{for(var u=n.__values(a),s=u.next();!s.done;s=u.next()){var c=s.value;!function(e){var t,o,a=i(e.post_id).filter(function(t){return t!==e}),u=a.filter(function(t){return t.creation_date>e.creation_date});if(r.IsReversableType(e.reputation_history_type)){var s=r.GetReversalTypes(e.reputation_history_type),c=u.filter(function(t){return!!s.find(function(e){return e===t.reputation_history_type})&&(t.reputation_change===-1*e.reputation_change||0===t.reputation_change||0===e.reputation_change)});try{for(var l=n.__values(c),p=l.next();!p.done;p=l.next()){var d=p.value;d.ReversedBy||(d.ReversedBy=[]),d.Reversed.push(e)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(t)throw t.error}}e.ReversedBy=c}}(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(o=u.return)&&o.call(u)}finally{if(t)throw t.error}}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.FindEventReversals=o}.apply(t,r))&&(e.exports=o)}]);